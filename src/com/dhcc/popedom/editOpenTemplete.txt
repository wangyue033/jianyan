<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<%@ page language="java" pageEncoding="UTF-8"%>
<%@ taglib uri="/struts-tags" prefix="s"%>
<%
String path = request.getContextPath();
String result = (String) request.getAttribute("result");
%>

<html>
  <head>
    <title>My JSP '{{domainName}}_edit.jsp' starting page</title>
    <link href="<%=path %>/css/style.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="<%=path%>/js/poshytip/poshytip.css" />
	<script type="text/javascript" src="<%=path%>/js/jquery/jquery-0.min.js"></script>
    <!--[if IE 8]>
       <script src="<%=path%>/js/es5-shim.min.js"></script>
    <![endif]-->
    <script type="text/javascript" src="<%=path %>/js/angular.min-1.4.7.js"></script>
    <script type="text/javascript" src="<%=path%>/js/poshytip/jquery.poshytip.js"></script>
	<script type="text/javascript" src="<%=path%>/js/validate/jquery.validate.js"></script>
	<script type="text/javascript" src="<%=path%>/js/validate/messages_cn.js"></script>
	<script type="text/javascript" src="<%=path%>/js/BaceSpaceDisabled.js"></script>
<script>
	$(document).ready(function(){
	  $(':input[type!=select][type!=button][type!=checkbox][type!=radio][type!=submit]').focus(function () {	
		if($(this).prop("readonly") == false) {
			$(this).css("background", "#ffffdd"); 
		}
	  });
	  $(':input[type!=select][type!=button][type!=checkbox][type!=radio][type!=submit]').blur(function () { 
		$(this).css("background", "#ffffff"); 
	  });
	  $("#jobName").focus();
	  $("#myForm").validate({
		rules: {
			{{ruleList}}
		}
	  });
	});
</script>
  </head>
  
  <body class="bodybg">
  <div ng-app="{{domainName}}" ng-controller="Edit">
    <form name="myForm" id="myForm" >
	  <table class="biaodan" cellpadding="0" cellspacing="0" border="0">
	  	<tr style="height:30px;">
			<td class="msg" colspan="4">
				{{msgInfo}}
			</td>
		</tr>
		{{tableList}}
	  </table>
	  <div class="layer-bottom">
		<div class="div-bottom">
			<input type="button" id="btnmysave" value="确认" ng-click="processForm()" tabindex="{{myindex}}" ng-disabled="mydisabled" class="{{mybutton}} button1"/>
	       	<input type="button" id="btnmyclose" value="关闭" ng-click="myclose()" class="button3"/>
       	</div>
	  </div>
    </form>
    </div>
   <script type="text/javascript">
var {{domainName}}s = angular.module('{{domainName}}', []);
{{domainName}}s.controller('Edit', function($scope, $http) {
	
	$scope.myclose = function() {
        var index = parent.layer.getFrameIndex(window.name);
		parent.layer.close(index);
    }
    $scope.{{priColumn}} = '${{{priColumn}}}';
	$scope.url = "<%=path%>/{{namespace}}/{{domainName}}_edit.action?oper=1&{{priColumn}}="+$scope.{{priColumn}};
	$http.post($scope.url).success(function(data){
        var msg = data.msg;
        if(msg == "true"){
        	$scope.{{domainList}} = data.record;
        }else if(msg == "norecord"){
        	$scope.msgInfo = data.msgInfo;
        	alert("无记录！");
        }
    });
    $scope.processForm = function() {
    	var flag = $("#myForm").valid();
   		if(flag){
			$scope.{{domainList}}.oper = 2;
			$http.post('<%=path%>/{{namespace}}/{{domainName}}_edit.action?'+$.param($scope.{{domainList}}))
			.success(function(data) {
				var msg = data.msg;
				$scope.msgInfo = data.msgInfo;
				$scope.visible = true;
				if(msg == "true"){
					var listWin = window.parent.document.getElementById("outerFrame").contentWindow.document.getElementById("mainFrame");
					var scope = listWin.contentWindow.angular.element('#{{domainName}}_list').scope();
					scope.searchList();
					
					$scope.mydisabled=true;
					$scope.msgInfo = data.msgInfo;
					$scope.myreadonly = true;
					$scope.mybutton = "hui-but";
					document.getElementById("btnmyclose").focus();
				}else{
					$scope.msgInfo = data.msgInfo;
				}
			});
		}
	};
})

</script>
  </body>
</html>
